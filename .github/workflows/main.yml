# Test 2024-11-19 at 03:32:57
# https://setuptools.pypa.io/en/latest/userguide/quickstart.html

name: Test
run-name: createAndInstallPythonPackage

on:
  push:
    paths:
      - '**/main.yml'

jobs:
  test:
    runs-on: ubuntu-24.04
    steps:
    - uses: actions/checkout@v4                                                 # Check the repo out into folder aaa
      with:
        path: aaa

    - name: Build
      run: |
        pwd
        python3 -m venv aaa                                                     # Create Python virtual environment in folder aaa
        cd aaa
        source bin/activate                                                     # Activate Python virtual environment
        python3 -m pip install --upgrade build                                  # Install build locally
        python3 -m build                                                        # Build the package based onthe toml file
        cd

    - name: List zip
      run: |
       unzip -l aaa/dist/Sample-0.1.0-py3-none-any.whl                          # List the contents of the whl file

    - name: Install                                                             # Install the whl file in a different Python virtual environment
      run: |
        mkdir bbb                                                               # Different folder
        pwd
        python3 -m venv bbb
        cd bbb
        source bin/activate                                                     # Activate Python virtual environment
        python3 -m pip install ../aaa/dist/Sample-0.1.0-py3-none-any.whl        # Install using pip as normal
        python3 -m pip show sample                                              # Show installation
        tree ./lib/python3.12/site-packages/sample                              # Show installed files
        cd

    - name: Run installed command
      run: |
        cd bbb
        source bin/activate                                                     # Activate Python virtual environment in new folder
        python3 -m sample.app                                                   # Run the app and expect to get:
# Hello World!
